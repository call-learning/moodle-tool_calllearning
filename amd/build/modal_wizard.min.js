define("tool_calllearning/modal_wizard",["exports","core/modal","core/notification","core/custom_interaction_events","jquery","./wizard_repository"],(function(_exports,_modal,_notification,CustomEvents,_jquery,_wizard_repository){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_modal=_interopRequireDefault(_modal),_notification=_interopRequireDefault(_notification),CustomEvents=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(CustomEvents),_jquery=_interopRequireDefault(_jquery),_wizard_repository=_interopRequireDefault(_wizard_repository);class ModalWizard extends _modal.default{constructor(root){super(root),_defineProperty(this,"wizardUniqueId",null),this.removeOnClose=!0,this.getFooter().find(this.getActionSelector("cancel")).length||_notification.default.exception({message:"No cancel button found"})}configure(){let param0=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.configure(param0);const{wizardUniqueId:wizardUniqueId=null}=param0;this.wizardUniqueId=wizardUniqueId,this.wizardUniqueId||_notification.default.exception({message:"No wizardUniqueId provided"})}registerEventListeners(){super.registerEventListeners(),this.registerCloseOnSave(),this.registerCloseOnCancel(),this.registerEventNext(),this.registerEventPrevious()}registerEventNext(){this.getModal().on(CustomEvents.events.activate,this.getActionSelector("next"),((e,data)=>{const nextEvent=new CustomEvent(ModalWizard.EVENTS.next,{detail:this});this.getRoot().trigger(nextEvent,this),nextEvent.isDefaultPrevented()||data.originalEvent.preventDefault()}))}registerEventPrevious(){this.getModal().on(CustomEvents.events.activate,this.getActionSelector("previous"),((e,data)=>{const previousEvent=new CustomEvent(ModalWizard.EVENTS.previous,{detail:this});this.getRoot().trigger(previousEvent,this),previousEvent.isDefaultPrevented()||data.originalEvent.preventDefault()}))}loadStepContent(stepId){const params={stepid:stepId,wizardid:this.wizardUniqueId};_jquery.default.ajax({url:M.cfg.wwwroot+"/admin/tool/calllearning/wizard/stepcontent.php",method:"POST",data:params,success:response=>{"form"===response.type?this.setFormContent(response.html):this.setNonInteractiveContent(response.html)},error:()=>{_notification.default.alert("Error","Failed to load step content.","")}})}setFormContent(html){const bodyContent=Promise.resolve({html:html});this.getModal().setBodyContent(bodyContent),this.getModal().getRoot().on("submit","form",(e=>{e.preventDefault(),this.validateForm()&&this.submitFormAjax()}))}setNonInteractiveContent(html){const bodyContent=Promise.resolve({html:html});this.getModal().setBodyContent(bodyContent)}async submitFormAjax(){if(!this.validateForm())return void _notification.default.alert("Validation Error","Please correct the errors in the form.","");this.disableButtons();const formData=this.getModal().getRoot().find("form").serialize();_wizard_repository.default.submitDynamicForm({formdata:formData,form:"form_wizard"}).then((response=>{response.error?(this.setFormContent(response.exception.message),this.enableButtons()):response.data.submitted?this.loadStepContent(response.data.nextstep):(this.setFormContent(response.data.html),this.enableButtons())})).catch((exception=>{_notification.default.exception(exception),this.enableButtons()}))}validateForm(){const invalid=this.getModal().getRoot().find('[aria-invalid="true"], .error');return!invalid.length||(invalid.first().focus(),!1)}disableButtons(){this.getModal().getFooter().find("[data-action]").attr("disabled",!0)}enableButtons(){this.getModal().getFooter().find("[data-action]").removeAttr("disabled")}}return _exports.default=ModalWizard,_defineProperty(ModalWizard,"TYPE","WIZARD"),_defineProperty(ModalWizard,"TEMPLATE","tool_calllearning/modal_wizard"),_defineProperty(ModalWizard,"EVENTS",{next:"modal-wizard:next",previous:"modal-wizard:previous"}),ModalWizard.registerModalType(),_exports.default}));

//# sourceMappingURL=modal_wizard.min.js.map